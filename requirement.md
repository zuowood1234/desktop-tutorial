# 股票短线交易助手需求文档

## 1. 项目概述
开发一个专注于 A 股市场的短线交易辅助网页应用（v3.0 版本）。
系统利用大模型（如 DeepSeek），结合**技术面（Technical）**与**情绪面（Sentiment）**等多重策略，每日为用户生成短线操作建议。
核心特色在于**多页面一站式架构**、**量化维度的历史回测与资金收益模拟**，通过数据直观验证 AI 建议的盈利能力，并计算超额收益（Alpha）。

## 2. 系统架构 (多页面应用 Multi-page App)
系统采用多页面架构，以降低单次运行负载并实现模块解耦。
*   **首页 (`app.py`)**: 一站式入口与导航门户，处理用户登录/注册拦截。登录后展示快捷功能入口，后续计划增加“今日指数实时涨幅”总览板。
*   **自选股管理 (`pages/1_⭐_我的自选.py`)**: 用户的核心资产池，支持批量导入、标签管理。
*   **实时分析 (`pages/2_📊_实时分析.py`)**: 主动式实时分析核心。对接实时行情接口，调用四大策略（V1-V4）生成即时操作建议。
*   **历史复盘 (`pages/3_📅_历史复盘.py`)**: 原每日建议升级版。展示并重现每日盘后系统自动跑批留存的历史分析记录与策略分数。
*   **策略说明 (`pages/4_📖_策略说明.py`)**: 静态透明地展示系统内置的评判逻辑与运算因子。
*   **策略回测 (`pages/5_📈_策略回测.py`)**: **(当前重点开发模块)** 支持用户自定义时间段、设定本金，利用历史数据严格校验各内置策略的实盘收益率与胜率。
*   **管理后台 (`pages/9_👑_管理后台.py`)**: 管理员专属，监控全站用户状态、权限及后台自动任务运行情况。
*   *(待开发)* **市场分析 & 股票记录**: 未来规划的新页面，用于大盘异动监测与个人的交易笔记。

## 3. 核心功能详情

### 3.1 智能建议系统 (V1-V4 进阶策略)
*   **V1 综合记分**: 基于六大技术维度（趋势、结构、动能、量能、情绪、强弱）的量化打分模型。
*   **V2 趋势猎手**: 均线金叉/死叉判定系统，主抓右侧交易主升浪。
*   **V3 波段防御**: 基于均值回归与布林带（Bollinger Bands）的震荡恐慌抄底模型。
*   **V4 AI智能体**: 将量化因子打包为自然语言 Prompt，交由 LLM 推演复杂逻辑与非线性关联。
*   **自动化机制**: 每日 A 股收盘后（15:15后），系统利用钩子自动全量跑批用户的自选股，落库形成“历史复盘”存档。

### 3.2 深度历史回测与收益计算 (当前重点开发)
*   **回测引擎 (`backtest_engine.py` 升级)**：
    *   利用 Pandas 高效处理 AkShare 获取的历史 K 线。
    *   严格规避未来函数，模拟真实的 T+1 交易滑点与印花税/佣金损耗。
*   **收益率计算**：
    *   **累计收益率**：策略资金曲线 vs 基准（如持有标的本身或沪深300）。
    *   **可视化呈现**: 使用 Plotly 等画图库绘制资金曲线对比图。

### 3.3 数据存储与底层架构 
*   **现状**：目前使用本地 **SQLite** (`investor_assistant.db`) 存储用户数据、自选股及历史建议。并在 `utils.py` 中实现了连接池与统一拦截器。
*   **目标**：迁移至云端 **Supabase (PostgreSQL)** (按需执行)。

## 4. 技术栈
*   **前端/应用层**：Streamlit (多页面特性 Multi-page)。
*   **后端逻辑**：Python (Pandas处理数据、LLM 交互、回测计算)。
*   **数据库**：SQLite (通过 `database.py` 统一封装，预留 Supabase 迁移接口)。
*   **AI 模型**：兼容 OpenAI / DeepSeek API 格式的大模型。
*   **数据源**：AkShare (开源财经数据接口)、新浪/东财实时行情。
*   **部署**：本地运行 / Streamlit Cloud / Docker。
